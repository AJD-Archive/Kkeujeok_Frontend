import { useEffect, useState, useCallback, useRef } from 'react';
import Navbar from '../components/Navbar';
import * as S from '../styles/TutorialPageStyled';
import personal_tutorial from '../img/personal_tutorial.png';
import team_tutorial from '../img/team_tutorial.png';
import { useQuery } from '@tanstack/react-query';
import { userInfoApi } from '../api/UserApi';
import { useAtom } from 'jotai';
import { nicknameAtom } from '../contexts/NickName';
import { useNavigate } from 'react-router-dom';

const TutorialPage = () => {
  const navigate = useNavigate();
  const { data: UserInfo, refetch } = useQuery({ queryKey: ['userinfo'], queryFn: userInfoApi });
  const [nickname, setNickname] = useAtom(nicknameAtom);

  // 닉네임을 API에서 받아와서 atom에 저장
  useEffect(() => {
    if (UserInfo?.data.nickName && nickname === null) {
      setNickname(UserInfo.data.nickName);
    }
  }, [UserInfo, nickname, setNickname]);

  return (
    <S.MainDashBoardLayout>
      <Navbar />
      <S.MainDashBoardContainer>
        <S.Title>{nickname}님, 안녕하세요.</S.Title>

        <div>
          <S.SubTitle>개인 대시보드</S.SubTitle>
          <S.tutorialContainer onClick={() => navigate('/createPersonalBoard')}>
            <div>
              <div>
                <svg
                  width="37"
                  height="37"
                  viewBox="0 0 37 37"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    fillRule="evenodd"
                    clipRule="evenodd"
                    d="M12.7965 14.6109C11.6037 15.8038 10.8066 17.3347 10.5135 18.9961L9.58711 24.2364C9.51026 24.6705 9.53928 25.1168 9.67173 25.5374C9.80417 25.9579 10.0361 26.3403 10.3479 26.6521C10.6597 26.9639 11.0421 27.1958 11.4626 27.3283C11.8832 27.4607 12.3295 27.4897 12.7636 27.4129L18.0039 26.4865C19.6653 26.1934 21.1962 25.3963 22.3891 24.2035L30.8032 15.7894L36.2847 10.3079C36.741 9.84781 36.998 9.22657 37 8.57852C37 6.30335 36.0962 4.12137 34.4874 2.51259C32.8786 0.903806 30.6966 0 28.4215 0C27.7721 0.00201495 27.1497 0.260037 26.6893 0.718074L21.2079 6.19956L12.7965 14.6109ZM23.5841 9.63919L15.7017 17.5188C15.1058 18.1154 14.7077 18.8809 14.5616 19.7114L13.9778 23.0222L17.2886 22.4384L17.4448 22.411C18.2164 22.2434 18.9233 21.8571 19.4812 21.2983L27.3608 13.4159C27.2221 12.4636 26.7795 11.5815 26.099 10.901C25.4185 10.2205 24.5364 9.77792 23.5841 9.63919ZM30.5949 10.1846C29.7686 8.55453 28.4449 7.22983 26.8154 6.40237L29.0628 4.15496C30.0169 4.2929 30.9009 4.73579 31.5825 5.41747C32.2642 6.09915 32.7071 6.98306 32.845 7.93718L30.5949 10.1846ZM17.8148 3.42593C17.8148 2.88076 17.5982 2.35792 17.2128 1.97243C16.8273 1.58694 16.3044 1.37037 15.7593 1.37037H8.22222C6.04155 1.37037 3.9502 2.23664 2.40823 3.7786C0.866268 5.32057 0 7.41192 0 9.59259V28.7778C0 30.9584 0.866268 33.0498 2.40823 34.5918C3.9502 36.1337 6.04155 37 8.22222 37H27.4074C29.5881 37 31.6794 36.1337 33.2214 34.5918C34.7634 33.0498 35.6296 30.9584 35.6296 28.7778V21.2407C35.6296 20.6956 35.4131 20.1727 35.0276 19.7872C34.6421 19.4018 34.1192 19.1852 33.5741 19.1852C33.0289 19.1852 32.5061 19.4018 32.1206 19.7872C31.7351 20.1727 31.5185 20.6956 31.5185 21.2407V28.7778C31.5185 29.8681 31.0854 30.9138 30.3144 31.6848C29.5434 32.4558 28.4977 32.8889 27.4074 32.8889H8.22222C7.13189 32.8889 6.08621 32.4558 5.31523 31.6848C4.54424 30.9138 4.11111 29.8681 4.11111 28.7778V9.59259C4.11111 8.50226 4.54424 7.45658 5.31523 6.6856C6.08621 5.91462 7.13189 5.48148 8.22222 5.48148H15.7593C16.3044 5.48148 16.8273 5.26491 17.2128 4.87942C17.5982 4.49393 17.8148 3.97109 17.8148 3.42593Z"
                    fill="url(#paint0_linear_264_451)"
                  />
                  <defs>
                    <linearGradient
                      id="paint0_linear_264_451"
                      x1="18.5"
                      y1="0"
                      x2="18.5"
                      y2="37"
                      gradientUnits="userSpaceOnUse"
                    >
                      <stop stopColor="#00D1FF" />
                      <stop offset="0.5" stopColor="#4C8CFF" />
                      <stop offset="1" stopColor="#9847FF" />
                    </linearGradient>
                  </defs>
                </svg>
              </div>
              <S.content>
                정신 없는 하루도,
                <br />
                복잡한 작업도 끄적끄적과 함께 해요.
              </S.content>
            </div>
            <S.TutorialImage src={personal_tutorial} alt="개인 대시보드 튜토리얼"></S.TutorialImage>
          </S.tutorialContainer>
        </div>

        <div>
          <S.SubTitle>팀 대시보드</S.SubTitle>
          <S.tutorialContainer onClick={() => navigate('/createTeamBoard')}>
            <div>
              <div>
                <svg
                  width="40"
                  height="36"
                  viewBox="0 0 40 36"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M25.508 14C27.44 14 29.008 15.568 29.008 17.5V26.998C29.008 29.3855 28.0596 31.6752 26.3714 33.3634C24.6832 35.0516 22.3935 36 20.006 36C17.6185 36 15.3288 35.0516 13.6406 33.3634C11.9524 31.6752 11.004 29.3855 11.004 26.998V17.5C11.004 15.568 12.57 14 14.504 14H25.508ZM25.508 17H14.504C14.3714 17 14.2442 17.0527 14.1504 17.1464C14.0567 17.2402 14.004 17.3674 14.004 17.5V26.998C14.004 28.5898 14.6364 30.1165 15.7619 31.2421C16.8875 32.3676 18.4142 33 20.006 33C21.5978 33 23.1245 32.3676 24.2501 31.2421C25.3756 30.1165 26.008 28.5898 26.008 26.998V17.5C26.008 17.3674 25.9553 17.2402 25.8616 17.1464C25.7678 17.0527 25.6406 17 25.508 17ZM3.5 14H10.262C9.55661 14.8523 9.12572 15.8982 9.026 17H3.5C3.36739 17 3.24022 17.0527 3.14645 17.1464C3.05268 17.2402 3 17.3674 3 17.5V23.998C2.99949 24.7539 3.17037 25.5001 3.49979 26.1804C3.82921 26.8607 4.3086 27.4575 4.9019 27.9259C5.4952 28.3943 6.18698 28.722 6.9252 28.8845C7.66342 29.047 8.42887 29.04 9.164 28.864C9.334 29.872 9.644 30.834 10.07 31.728C9.40867 31.908 8.71867 31.9987 8 32C6.94926 32 5.90881 31.793 4.93807 31.3908C3.96734 30.9887 3.08533 30.3992 2.34244 29.6561C1.59954 28.9131 1.01031 28.0309 0.60839 27.0601C0.20647 26.0892 -0.000262436 25.0487 2.50023e-07 23.998V17.5C2.50023e-07 15.568 1.568 14 3.5 14ZM29.75 14H36.5C38.432 14 40 15.568 40 17.5V24C40.0003 25.2263 39.7186 26.4363 39.1768 27.5364C38.6349 28.6366 37.8474 29.5974 36.8751 30.3447C35.9028 31.092 34.7717 31.6058 33.5692 31.8464C32.3667 32.0869 31.125 32.0478 29.94 31.732C30.368 30.836 30.678 29.874 30.85 28.866C31.2193 28.954 31.6027 28.9987 32 29C33.3261 29 34.5979 28.4732 35.5355 27.5355C36.4732 26.5979 37 25.3261 37 24V17.5C37 17.3674 36.9473 17.2402 36.8536 17.1464C36.7598 17.0527 36.6326 17 36.5 17H30.986C30.8863 15.8982 30.4554 14.8523 29.75 14ZM20 0C21.5913 0 23.1174 0.632141 24.2426 1.75736C25.3679 2.88258 26 4.4087 26 6C26 7.5913 25.3679 9.11742 24.2426 10.2426C23.1174 11.3679 21.5913 12 20 12C18.4087 12 16.8826 11.3679 15.7574 10.2426C14.6321 9.11742 14 7.5913 14 6C14 4.4087 14.6321 2.88258 15.7574 1.75736C16.8826 0.632141 18.4087 0 20 0ZM33 2C34.3261 2 35.5979 2.52678 36.5355 3.46447C37.4732 4.40215 38 5.67392 38 7C38 8.32608 37.4732 9.59785 36.5355 10.5355C35.5979 11.4732 34.3261 12 33 12C31.6739 12 30.4021 11.4732 29.4645 10.5355C28.5268 9.59785 28 8.32608 28 7C28 5.67392 28.5268 4.40215 29.4645 3.46447C30.4021 2.52678 31.6739 2 33 2ZM7 2C8.32608 2 9.59785 2.52678 10.5355 3.46447C11.4732 4.40215 12 5.67392 12 7C12 8.32608 11.4732 9.59785 10.5355 10.5355C9.59785 11.4732 8.32608 12 7 12C5.67392 12 4.40215 11.4732 3.46447 10.5355C2.52678 9.59785 2 8.32608 2 7C2 5.67392 2.52678 4.40215 3.46447 3.46447C4.40215 2.52678 5.67392 2 7 2ZM20 3C19.2044 3 18.4413 3.31607 17.8787 3.87868C17.3161 4.44129 17 5.20435 17 6C17 6.79565 17.3161 7.55871 17.8787 8.12132C18.4413 8.68393 19.2044 9 20 9C20.7956 9 21.5587 8.68393 22.1213 8.12132C22.6839 7.55871 23 6.79565 23 6C23 5.20435 22.6839 4.44129 22.1213 3.87868C21.5587 3.31607 20.7956 3 20 3ZM33 5C32.4696 5 31.9609 5.21071 31.5858 5.58579C31.2107 5.96086 31 6.46957 31 7C31 7.53043 31.2107 8.03914 31.5858 8.41421C31.9609 8.78929 32.4696 9 33 9C33.5304 9 34.0391 8.78929 34.4142 8.41421C34.7893 8.03914 35 7.53043 35 7C35 6.46957 34.7893 5.96086 34.4142 5.58579C34.0391 5.21071 33.5304 5 33 5ZM7 5C6.46957 5 5.96086 5.21071 5.58579 5.58579C5.21071 5.96086 5 6.46957 5 7C5 7.53043 5.21071 8.03914 5.58579 8.41421C5.96086 8.78929 6.46957 9 7 9C7.53043 9 8.03914 8.78929 8.41421 8.41421C8.78929 8.03914 9 7.53043 9 7C9 6.46957 8.78929 5.96086 8.41421 5.58579C8.03914 5.21071 7.53043 5 7 5Z"
                    fill="url(#paint0_linear_264_465)"
                  />
                  <defs>
                    <linearGradient
                      id="paint0_linear_264_465"
                      x1="20"
                      y1="0"
                      x2="20"
                      y2="36"
                      gradientUnits="userSpaceOnUse"
                    >
                      <stop stopColor="#00D1FF" />
                      <stop offset="0.5" stopColor="#4C8CFF" />
                      <stop offset="1" stopColor="#9847FF" />
                    </linearGradient>
                  </defs>
                </svg>
              </div>
              <S.content>
                협업도 문제 없어요.
                <br />
                팀원을 등록하고 프로젝트를 관리해요.
              </S.content>
            </div>
            <S.TutorialImage src={team_tutorial} alt="팀 대시보드 튜토리얼"></S.TutorialImage>
          </S.tutorialContainer>
        </div>
      </S.MainDashBoardContainer>
    </S.MainDashBoardLayout>
  );
};

export default TutorialPage;
